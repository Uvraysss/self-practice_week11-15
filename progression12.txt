
สรุปสิ่งที่ได้เรียนรู้ในสัปดาห์ที่ 12

    สรุป self-practice ที่ได้ในวันนี้ เป็นการสร้างโปรเจค โดยมี 3 หน้าหลัก ๆ คือ index.html keycloak.html และ reserve.html 
    โดยอธิบายได้ดังนี้ index.html — เริ่มต้นการทำงานของผู้ใช้ในหน้าแรกของระบบ มีปุ่มสำหรับเข้าสู่หน้าจัดการข้อมูล เมื่อผู้ใช้กดปุ่ม ระบบจะใช้ JavaScript 
    ค้นหา element ที่มี id "manageBtn" และกำหนดเหตุการณ์ click ให้เปลี่ยนหน้าไปยัง keycloak.html ซึ่งเป็นหน้าที่รับผิดชอบกระบวนการเข้าสู่ระบบ
    นอกจากนี้ หน้ายังตั้งตัวแปร baseUrl เพื่อกำหนด URL ของ backend API โดยตรวจสอบจาก window.location.hostname ว่าระบบทำงานในเครื่อง (localhost) 
    หรือบนเซิร์ฟเวอร์จริง เพื่อนำทาง API ให้ถูกต้องตาม environment ฟังก์ชัน fetchStudyPlans() ทำหน้าที่เรียก API /api/study-plans 
    และดึงข้อมูลแผนการเรียนมาแสดงบนตาราง หากข้อมูลว่างหรือการเชื่อมต่อล้มเหลว จะมีการแจ้งเตือนผ่าน popup (ErrorPopup()) สำหรับความผิดพลาดที่เกิดจากการ fetch API
    ต่อมา หน้า keycloak.html — หน้าสำหรับจัดการการล็อกอิน หน้า keycloak.html เป็นจุดเริ่มต้นของระบบ authentication โดยตรวจสอบว่าเว็บไซต์กำลังรันบน 
    local หรือ production เพื่อเลือก config ของ Keycloak ให้ถูกต้อง เช่น URL ของ Keycloak server, realm และ clientId ที่ใช้ภายในไฟล์นี้มีการสร้าง 
    Keycloak instance ผ่านคำสั่ง const keycloak = new Keycloak(KC); ซึ่งเป็นการสร้างออบเจ็กต์ที่ใช้ควบคุมการทำงานทั้งหมดของ Keycloak ในฝั่ง frontend เช่น 
    การล็อกอิน, การตรวจสอบ token และการออกจากระบบ ส่วนสำคัญที่สุดคือการเรียกใช้ keycloak.init({ onLoad: "login-required", checkLoginIframe: false })
    โดย onLoad: "login-required" บังคับให้ Keycloak ตรวจสอบการเข้าสู่ระบบทันที หากยังไม่ล็อกอินจะ redirect ไปหน้า login ของ Keycloak 
    checkLoginIframe: false ปิดฟีเจอร์ตรวจสอบสถานะการเข้าสู่ระบบผ่าน iframe เมื่อล็อกอินสำเร็จ ระบบจะเก็บ access token และ refresh token ไว้ใน sessionStorage 
    เพื่อให้ reserve.html สามารถดึงไปใช้งานต่อได้ และสุดท้าย redirect ผู้ใช้ไปหน้า reserve.html
    สุดท้าย หน้า reserve.html — หน้าแสดงข้อมูลผู้ใช้และจัดการแผนการเรียน เมื่อเข้าสู่หน้า reserve.html ระบบจะเริ่มต้นด้วยการตรวจสอบว่าใน sessionStorage มี token 
    ที่ได้จากการล็อกอินหรือไม่ หากไม่มี จะ redirect กลับไปหน้า keycloak.html เพื่อบังคับให้ผู้ใช้เข้าสู่ระบบใหม่ จากนั้นระบบสร้าง Keycloak instance และเรียก keycloak.init() 
    โดยส่ง token ที่มีอยู่ เพื่อให้ Keycloak ตรวจสอบว่า token ยังใช้ได้หรือไม่ หลังจาก init สำเร็จจะสามารถดึงข้อมูลผู้ใช้จาก keycloak.tokenParsed เช่น ชื่อ และรหัสนักศึกษา 
    เพื่อใช้ในระบบ ระบบมี feature สำคัญคือการต่ออายุ token อัตโนมัติด้วยคำสั่ง

    setInterval(() => {
    keycloak.updateToken(60)
    }, 60000);

    ซึ่งหมายความว่า จะพยายามต่ออายุ token ทุก 60 วินาที หาก token จะหมดอายุภายใน 60 วินาที เพื่อให้ผู้ใช้ไม่ถูกล็อกเอาท์โดยไม่จำเป็น สำหรับข้อมูลของแผนการเรียน มีฟังก์ชัน loadPlanList() 
    ที่นำข้อมูลแผนมาสร้าง dropdown ให้ผู้ใช้เลือก และ loadDeclaredPlan(studentId) ที่ใช้เรียก API เพื่อดึงข้อมูลการประกาศแผนของผู้ใช้ เมื่อผู้ใช้กดปุ่มประกาศแผน 
    ฟังก์ชันจะเรียก API แบบ POST ไปยัง endpoint เดียวกันเพื่อตรวจสอบสถานะการประกาศ โดยตอบสนองตาม code ต่าง ๆ เช่น 201 → ประกาศสำเร็จ
    409 → เคยประกาศแล้ว และ อื่น ๆ → แจ้งว่าเกิดปัญหา โดยทุกกรณีมีการแสดงผลผ่าน showDialog() ซึ่งเป็นฟังก์ชัน modal popup 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
น.ส.ธันวาวีร์ นิธิพรชัยวงศ์ รหัสนักศึกษา: 67130500131